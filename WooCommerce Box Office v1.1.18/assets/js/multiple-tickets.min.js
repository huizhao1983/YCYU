!function(r){var l,e,c;l=r.extend({formSelector:".wc-box-office-ticket-form",templateDOMSelector:".wc-box-office-ticket-fields:first",fieldsTemplate:{}},ticketFormParams),e=Backbone.View.extend({initialize:function(t){this.qty=l.is_admin?r('[name="quantity"]'):this.$el.parent().find('[name="quantity"]:first'),this.qty.on("change",r.proxy(this.updateQty,this)),this.addToCart=r(".wc-box-office-ticket-form").parent().find(".single_add_to_cart_button"),this.tickets=[],this.prevTicketEls=[]},updateQty:function(){this.removeTickets(),this.render()},render:function(){var t=parseInt(this.qty.val(),10),e=0;this.qty.length||(t=1);for(var i=0;i<t;i++){var a=new c({index:i,parent:this});if(this.tickets.push(a),this.$el.append(a.render().el),l.posted_data&&l.posted_data[i])for(var s in l.posted_data[i]){var n=l.posted_data[i][s];n&&this.setElValue(r('[id^="field_'+s+'"]',a.$el),n)}if(this.prevTicketEls[i])this.prevTicketEls[i].hasClass("active")&&(a.toggle(),e+=1),this.copyValuesFromPreviousElement(i)}return l.posted_data=[],!e&&this.tickets[0]&&this.tickets[0].toggle(),this.updateAddToCartText(),this},copyValuesFromPreviousElement:function(t){var i=this;r(".ticket-field-input",this.prevTicketEls[t]).each(function(){var t=r(this).attr("id"),e=r(this).val();e&&i.setElValue(r("#"+t,this.$el),e)})},setElValue:function(t,e){switch(t.prop("nodeName")){case"INPUT":"radio"===t.attr("type")?t.each(function(){r(this).prop("checked",e===this.value)}):t.val(e);break;default:t.val(e)}},removeTickets:function(){for(;this.prevTicketEls.length;)this.prevTicketEls.pop().remove();for(;this.tickets.length;){var t=this.tickets.shift();this.prevTicketEls.push(t.$el.clone()),t.remove()}},updateAddToCartText:function(){var t=parseInt(this.qty.val(),10),e=l.i18n_add_to_cart_singular;1<t&&(e=l.i18n_add_to_cart_plural),this.addToCart.text(e)}}),c=Backbone.View.extend({tagName:"div",active:!1,className:"wc-box-office-ticket-fields",events:{"click .wc-box-office-ticket-fields-title a":"toggle"},initialize:function(t){this.index=t.index||0,this.parent=t.parent},toggle:function(t){this.active=!this.active,this.$el.toggleClass("active",this.active),t&&t.preventDefault()},render:function(){return this.$el.html(l.getFieldsTemplate(this.parent)),this.updateFieldIndex(),this.updateTitle(),this},updateFieldIndex:function(){var s=this.$el,t=r('[name^="'+l.field_name_prefix+'"]',s),n=this.index;t.each(function(){var t=r(this).attr("name").substr(l.field_name_prefix.length),e=l.field_name_prefix.replace("[0]","["+n+"]")+t,i=r(this).attr("id"),a=i?i+"_"+n:"";r(this).attr("name",e),r(this).attr("id",a),r('label[for="'+i+'"]',s).attr("for",a)}),this.$el.attr("data-index",n)},updateTitle:function(){r(".wc-box-office-ticket-fields-title a",this.$el).html(l.i18n_ticket_title_prefix+(this.index+1))}}),l.getFieldsTemplate=function(t){if(!l.fieldsTemplate[t.cid]&&t.$el.find(l.templateDOMSelector).length){var e=t.$el.find(l.templateDOMSelector);l.fieldsTemplate[t.cid]=e.clone().removeAttr("style").html(),e.remove()}return l.fieldsTemplate[t.cid]},l.run=function(){r(l.formSelector).each(function(){var t=r(this);new e({el:t}).render()})},r(l.run)}(jQuery);
